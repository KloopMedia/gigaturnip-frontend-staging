(this["webpackJsonpgigaturnip-frontend"]=this["webpackJsonpgigaturnip-frontend"]||[]).push([[0],{312:function(e){e.exports=JSON.parse('{"type":"object","title":"Stage options","description":"Describe the stage you want.","properties":{"name":{"title":"Stage name","type":"string","description":"Example: Violation description form"},"description":{"title":"Stage description","type":"string","description":"Example: Form that describes an election violation","default":""},"is_creatable":{"type":"boolean","title":"Task is creatable","default":false},"copy_input":{"type":"boolean","title":"Copy input","default":false},"webhook_address":{"title":"Webhook address","type":"string","format":"uri"},"webhook_params":{"title":"Webhook parameters","type":"string"},"library":{"title":"Library","type":"string","default":""},"displayed_prev_stages":{"items":{"type":"number","title":"Stage"},"title":"Background Stages","type":"array"},"external_metadata":{"title":"External metadata","type":"object","properties":{"slides":{"type":"array","title":"Slides","items":{"type":"string"}}}}},"dependencies":{},"required":["name"]}')},322:function(e){e.exports=JSON.parse('{"title":"\u0421\u043e\u0437\u0434\u0430\u043d\u0438\u0435 \u0446\u0435\u043f\u043e\u0447\u043a\u0438","type":"object","required":["name"],"properties":{"name":{"type":"string","title":"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435"},"description":{"type":"string","title":"\u041e\u043f\u0438\u0441\u0430\u043d\u0438\u0435"}}}')},323:function(e){e.exports=JSON.parse('{"description":{"ui:widget":"textarea"}}')},354:function(e,t,n){},380:function(e,t,n){},554:function(e,t,n){},571:function(e,t,n){"use strict";n.r(t);var a=n(0),c=n.n(a),r=n(36),i=n.n(r),o=(n(354),n(39)),s=n(28),l=n(5),u=n.n(l),d=n(7),j=n(10),b=n(298),p=n(91),h=(Object(b.a)({apiKey:"AIzaSyCXiwOUNsbzKH7sbSAZrqA9f7VOeCMdUOQ",authDomain:"gigaturnip-b6b5b.firebaseapp.com",projectId:"gigaturnip-b6b5b",storageBucket:"gigaturnip-b6b5b.appspot.com",messagingSenderId:"414429242328",appId:"1:414429242328:web:a4685f5ac6895ea767c8ad",measurementId:"G-Y8JTEJMTET"}),Object(p.b)()),f=new p.a;f.setCustomParameters({prompt:"select_account"});var O=n(2),m=c.a.createContext(null),g=function(e){var t=e.children,n=Object(a.useState)(null),c=Object(j.a)(n,2),r=c[0],i=c[1],o=Object(a.useState)(!1),s=Object(j.a)(o,2),l=s[0],b=s[1];Object(a.useEffect)((function(){Object(p.d)(h,function(){var e=Object(d.a)(u.a.mark((function e(t){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i(t||null),b(!0);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}),[]);var g={user:r,ready:l,getToken:function(){var e=Object(d.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(p.c)(r);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),login:function(e){return Object(p.e)(h,f).then((function(t){var n=t.user;console.log(n),i(n),e()}))},logout:function(e){return Object(p.f)(h).then((function(){i(null),e()}))}};return Object(O.jsx)(m.Provider,{value:g,children:t})},x=function(){return c.a.useContext(m)},v={title:"Login",path:"/login"},y=n(644),C=function(e){var t=e.children,n=x(),a=Object(s.h)();return console.log(n),n.ready&&!n.user?Object(O.jsx)(s.a,{to:v.path,state:{from:a}}):n.ready?t:Object(O.jsx)(y.a,{})},S="api/v1/chains/",w="api/v1/taskstages/",k="api/v1/conditionalstages/",_="api/v1/responseflatteners/",N=n(301),I=n.n(N),E=function(){var e=x().getToken,t=I.a.create({baseURL:"https://journal-bb5e3.uc.r.appspot.com/"});t.interceptors.request.use((function(t){return e().then((function(e){return e&&t&&t.headers&&(t.headers.Authorization="JWT "+e),t}))}),(function(e){return Promise.reject(e)}));return{axios:t,getCampaigns:function(){return t.get("".concat("api/v1/campaigns/","?limit=1000")).then((function(e){return e.data})).then((function(e){return e.results}))},getChains:function(e){return t.get("".concat(S,"?campaign=").concat(e,"&limit=1000")).then((function(e){return e.data})).then((function(e){return e.results}))},createChain:function(e){return t.post("".concat(S),e)},getStageNodes:function(e,n){return t.get("".concat(w,"?ranks_avatars=true&chain__campaign=").concat(e,"&chain=").concat(n,"&limit=1000")).then((function(e){return e.data})).then((function(e){return e.results}))},getLogicNodes:function(e,n){return t.get("".concat(k,"?chain__campaign=").concat(e,"&chain=").concat(n,"&limit=1000")).then((function(e){return e.data})).then((function(e){return e.results}))},getTaskStage:function(e){return t.get("".concat(w+e,"/")).then((function(e){return e.data}))},saveTaskStage:function(e,n){return t.patch("".concat(w+e,"/"),n)},getTaskStageOptions:function(){return t.options("".concat(w)).then((function(e){return e.data}))},getConditionalStage:function(e){return t.get("".concat(k+e,"/")).then((function(e){return e.data}))},saveConditionalStage:function(e,n){return t.patch("".concat(k+e,"/"),n)},getResponseFlattenerList:function(e){return t.get("".concat(_,"?task_stage__chain__campaign=").concat(e)).then((function(e){return e.data})).then((function(e){return e.results}))},getResponseFlattener:function(e){return t.get("".concat(_+e,"/")).then((function(e){return e.data}))},downloadFlattenedResponses:function(e,n){return t.get("".concat(_+n,"/csv/"),{responseType:"blob"}).then((function(e){var t=window.URL.createObjectURL(new Blob([e.data])),n=document.createElement("a");n.href=t,n.setAttribute("download","results.csv"),document.body.appendChild(n),n.click()}))},saveResponseFlattener:function(e,n){return t.put("".concat(_+e,"/"),n)},createResponseFlattener:function(e){return t.post("".concat(_),e)}}},L=n(654),D=n(648),F=n(640),T=n(647),B=n(649),R=n(639),A=n(645),P=function(e){var t=e.data,n=e.onClick,a=t.name,c=t.description,r=t.id;return Object(O.jsxs)(A.a,{children:[Object(O.jsxs)(T.a,{sx:{pb:1},children:[Object(O.jsx)(D.a,{variant:"h5",component:"div",children:a}),Object(O.jsxs)(D.a,{gutterBottom:!0,variant:"caption",color:"text.secondary",children:["ID: ",r]}),Object(O.jsx)(D.a,{overflow:"hidden",textOverflow:"ellipsis",variant:"body2",sx:{height:60,maxWidth:500},children:c})]}),Object(O.jsx)(B.a,{children:Object(O.jsx)(R.a,{size:"small",onClick:function(){n(r)},children:"\u041e\u0442\u043a\u0440\u044b\u0442\u044c"})})]})},U=n(6),z=n(24),M=n(651),G=n(625),J=n(302),q=n.n(J),W=n(652),V=n(8),H=n(650),X=["expand"],Y=Object(V.a)((function(e){e.expand;var t=Object(z.a)(e,X);return Object(O.jsx)(H.a,Object(U.a)({},t))}))((function(e){var t=e.theme;return{transform:e.expand?"rotate(180deg)":"rotate(0deg)",marginLeft:"auto",transition:t.transitions.create("transform",{duration:t.transitions.duration.shortest})}})),$=function(e){var t=e.data,n=e.children,c=e.hideExpandButton,r=e.hideOpenButton,i=e.onClick,o=t.name,s=(t.description,t.id),l=Object(a.useState)(!1),u=Object(j.a)(l,2),d=u[0],b=u[1],p=[];return r||p.push(Object(O.jsx)(R.a,{variant:"contained",onClick:function(){i&&i(s)},children:"\u041e\u0442\u043a\u0440\u044b\u0442\u044c"},"open_button")),c||p.push(Object(O.jsx)(Y,{expand:d,onClick:function(){b(!d)},"aria-expanded":d,"aria-label":"show more",children:Object(O.jsx)(q.a,{})},"expand_button")),Object(O.jsxs)(A.a,{children:[Object(O.jsx)(M.a,{action:Object(O.jsx)(G.a,{direction:"row",spacing:1,children:p}),title:o,subheader:"ID: ".concat(s),titleTypographyProps:{variant:"h6"},subheaderTypographyProps:{variant:"caption"}}),Object(O.jsx)(W.a,{in:d,timeout:"auto",unmountOnExit:!0,children:Object(O.jsx)(T.a,{children:n})})]})},K=function(e){var t=e.data,n=e.view,a=e.onSelect;return t?"grid"===n?Object(O.jsx)(F.a,{container:!0,py:2,spacing:{xs:2,md:3},columns:{xs:4,sm:8,md:12},children:t.map((function(e,t){return Object(O.jsx)(F.a,{item:!0,xs:2,sm:4,md:4,children:Object(O.jsx)(P,{data:e,onClick:a})},t)}))}):"list"===n?Object(O.jsx)(F.a,{container:!0,py:2,spacing:2,children:t.map((function(e,t){return Object(O.jsx)(F.a,{item:!0,xs:12,children:Object(O.jsx)($,{data:e,hideExpandButton:!0,onClick:a})},t)}))}):null:Object(O.jsx)(D.a,{children:"Error"})},Q=n(641),Z=n(303),ee=n.n(Z),te=n(304),ne=n.n(te),ae=function(e){var t=e.label,n=e.view,a=e.location,c=e.hideCreateButton,r=e.hideViewButton,i=e.onViewChange;return Object(O.jsxs)(F.a,{container:!0,alignItems:"center",spacing:1,children:[Object(O.jsx)(F.a,{item:!0,flex:1,children:Object(O.jsx)(D.a,{hidden:!t,variant:"h4",children:t})}),Object(O.jsx)(F.a,{item:!0,hidden:c,children:Object(O.jsx)(R.a,{component:o.b,to:"new",state:{from:a},variant:"contained",sx:{"&:hover":{color:"white",boxShadow:"none"}},children:"\u0421\u043e\u0437\u0434\u0430\u0442\u044c"})}),Object(O.jsxs)(F.a,{item:!0,hidden:r,children:[Object(O.jsx)(Q.a,{title:"\u0421\u0435\u0442\u043a\u0430",children:Object(O.jsx)(H.a,{color:"grid"===n?"primary":"default",onClick:function(){return i("grid")},children:Object(O.jsx)(ee.a,{})})}),Object(O.jsx)(Q.a,{title:"\u0421\u043f\u0438\u0441\u043e\u043a",children:Object(O.jsx)(H.a,{color:"list"===n?"primary":"default",onClick:function(){return i("list")},children:Object(O.jsx)(ne.a,{})})})]})]})},ce=function(e){var t=e.id,n=e.data,c=e.label,r=e.defaultView,i=e.hideCreateButton,o=e.hideViewButton,l=e.onSelect,u=Object(s.h)(),d=Object(a.useState)(null!==r&&void 0!==r?r:"grid"),b=Object(j.a)(d,2),p=b[0],h=b[1];Object(a.useEffect)((function(){if(!r){var e=localStorage.getItem("".concat(t,"_view"))||"grid";e&&h(e)}}),[]);return Object(O.jsxs)(L.a,{children:[Object(O.jsx)(ae,{label:c,view:p,onViewChange:function(e){h(e),localStorage.setItem("".concat(t,"_view"),e)},location:u,hideCreateButton:i,hideViewButton:o}),Object(O.jsx)(K,{data:n,view:p,onSelect:l})]})},re=function(){var e=E().getCampaigns,t=Object(s.i)(),n=Object(a.useState)([]),c=Object(j.a)(n,2),r=c[0],i=c[1];Object(a.useEffect)((function(){e().then((function(e){return i(e)}))}),[]);return Object(O.jsx)(L.a,{px:3,py:1,children:Object(O.jsx)(ce,{id:"campaigns",data:r,hideCreateButton:!0,label:"\u041a\u0430\u043c\u043f\u0430\u043d\u0438\u0438",onSelect:function(e){t("/campaign/".concat(e,"/chain"))}})})},ie=function(){var e,t,n=x().login,a=Object(s.i)(),c=Object(s.h)(),r=(null===c||void 0===c||null===(e=c.state)||void 0===e||null===(t=e.from)||void 0===t?void 0:t.pathname)||"/";return Object(O.jsx)(R.a,{onClick:function(){n((function(){return a(r,{replace:!0})}))},children:"Login"})},oe=n(3),se=n(43),le=n(642),ue=n(659),de=n(655),je=n(658),be=n(661),pe=n(629),he=n(660),fe=n(307),Oe=n.n(fe),me=n(309),ge=n.n(me),xe=n(308),ve=n.n(xe),ye=n(636),Ce=n(656),Se=n(657),we=n(305),ke=n.n(we),_e=n(306),Ne=n.n(_e),Ie=240,Ee=function(e){return{width:Ie,transition:e.transitions.create("width",{easing:e.transitions.easing.sharp,duration:e.transitions.duration.enteringScreen}),overflowX:"hidden"}},Le=function(e){return Object(oe.a)({transition:e.transitions.create("width",{easing:e.transitions.easing.sharp,duration:e.transitions.duration.leavingScreen}),overflowX:"hidden",width:"calc(".concat(e.spacing(7)," + 1px)")},e.breakpoints.down("sm"),{width:0})},De=Object(V.a)("div")((function(e){var t=e.theme;return Object(U.a)({display:"flex",alignItems:"center",justifyContent:"flex-end",padding:t.spacing(0,1)},t.mixins.toolbar)})),Fe=Object(V.a)(de.a,{shouldForwardProp:function(e){return"open"!==e}})((function(e){var t=e.theme,n=e.open;return Object(U.a)({zIndex:t.zIndex.drawer+1,transition:t.transitions.create(["width","margin"],{easing:t.transitions.easing.sharp,duration:t.transitions.duration.leavingScreen})},n&&{marginLeft:Ie,width:"calc(100% - ".concat(Ie,"px)"),transition:t.transitions.create(["width","margin"],{easing:t.transitions.easing.sharp,duration:t.transitions.duration.enteringScreen})})})),Te=Object(V.a)(le.a,{shouldForwardProp:function(e){return"open"!==e}})((function(e){var t=e.theme,n=e.open;return Object(U.a)(Object(U.a)({width:Ie,flexShrink:0,whiteSpace:"nowrap",boxSizing:"border-box"},n&&Object(U.a)(Object(U.a)({},Ee(t)),{},{"& .MuiDrawer-paper":Ee(t)})),!n&&Object(U.a)(Object(U.a)({},Le(t)),{},{"& .MuiDrawer-paper":Le(t)}))}));function Be(e){var t=Object(se.a)(),n=Object(s.j)().campaignId,a=Object(s.i)(),r=x().logout,i=c.a.useState(!1),l=Object(j.a)(i,2),u=l[0],d=l[1],b=e.children,p=[{page:"chain",title:"\u0426\u0435\u043f\u043e\u0447\u043a\u0438",icon:Object(O.jsx)(ke.a,{})},{page:"flattener",title:"Flattener",icon:Object(O.jsx)(Ne.a,{})}];return Object(O.jsxs)(L.a,{sx:{display:"flex"},children:[Object(O.jsx)(pe.a,{}),Object(O.jsx)(Fe,{position:"fixed",open:u,children:Object(O.jsxs)(je.a,{children:[n&&Object(O.jsx)(H.a,{color:"inherit","aria-label":"open drawer",onClick:function(){d(!0)},edge:"start",sx:Object(U.a)({marginRight:"36px"},u&&{display:"none"}),children:Object(O.jsx)(Oe.a,{})}),Object(O.jsx)(L.a,{sx:{flexGrow:1},children:Object(O.jsx)(ue.a,{component:o.b,color:"inherit",underline:"none",variant:"h6",noWrap:!0,to:"/",sx:{"&:hover":{color:"white",boxShadow:"none"}},children:"GigaTurnip Admin Interface"})}),Object(O.jsx)(R.a,{color:"inherit",onClick:function(){return r((function(){return a("/")}))},children:"\u0412\u044b\u0445\u043e\u0434"})]})}),n&&Object(O.jsxs)(Te,{variant:"permanent",open:u,children:[Object(O.jsx)(De,{children:Object(O.jsx)(H.a,{onClick:function(){d(!1)},children:"rtl"===t.direction?Object(O.jsx)(ve.a,{}):Object(O.jsx)(ge.a,{})})}),Object(O.jsx)(he.a,{}),Object(O.jsx)(be.a,{children:p.map((function(e,t){return Object(O.jsxs)(ye.a,{component:o.b,to:"campaign/".concat(n,"/").concat(e.page),children:[Object(O.jsx)(Ce.a,{children:e.icon}),Object(O.jsx)(Se.a,{primary:e.title})]},t)}))})]}),Object(O.jsxs)(L.a,{component:"main",sx:{flexGrow:1,width:"100%"},children:[Object(O.jsx)(De,{}),b]})]})}var Re=function(){return Object(O.jsx)("div",{children:Object(O.jsx)(Be,{children:Object(O.jsx)(s.b,{})})})},Ae=function(){var e=E().getChains,t=Object(s.i)(),n=Object(s.j)().campaignId,c=Object(a.useState)([]),r=Object(j.a)(c,2),i=r[0],o=r[1];Object(a.useEffect)((function(){if(n){var t=parseInt(n);e(t).then((function(e){return o(e)}))}}),[]);return Object(O.jsx)(L.a,{px:3,py:1,children:Object(O.jsx)(ce,{id:"chains",data:i,label:"\u0426\u0435\u043f\u043e\u0447\u043a\u0438",onSelect:function(e){t("".concat(e))}})})},Pe=n(25),Ue=n(66),ze=Object(V.a)(L.a)((function(e){var t=e.theme,n=e.type;return{fontSize:"12px",width:"150px",textAlign:"center",color:"stage"===n?t.palette.success.contrastText:t.palette.primary.contrastText,backgroundColor:"stage"===n?t.palette.success.main:t.palette.primary.main,padding:t.spacing(1),borderRadius:t.shape.borderRadius}})),Me=function(e){var t=e.data,n=e.type;return Object(O.jsxs)(ze,{type:n,children:[Object(O.jsx)(D.a,{children:t.label}),Object(O.jsx)(Ue.b,{type:"target",position:Ue.c.Top,style:{borderRadius:"100%",width:10,height:10,left:75}}),Object(O.jsx)(Ue.b,{type:"source",position:Ue.c.Bottom,style:{borderRadius:"100%",width:10,height:10,left:75}})]})},Ge=Object(V.a)(Me)((function(e){var t=e.theme;return{color:t.palette.primary.contrastText,backgroundColor:t.palette.primary.main}})),Je=function(e){var t=e.conditions;return Object(O.jsx)(L.a,{children:t&&t.map((function(e,t){return Object(O.jsx)(D.a,{style:{border:"1px solid",borderRadius:"10px",background:"lightgrey"},px:1,variant:"body2",children:(n=e,"".concat(n.field," ").concat(n.condition," ").concat(n.value))},"condition_".concat(t));var n}))})},qe=function(e){var t=e.data;return Object(O.jsxs)(L.a,{display:"flex",alignItems:"center",children:[Object(O.jsx)(Ge,{data:t,type:"logic"}),Object(O.jsx)(Je,{conditions:t.conditions})]})},We=n(643),Ve=Object(V.a)(Me)((function(e){var t=e.theme;return{color:t.palette.success.contrastText,backgroundColor:t.palette.success.main}})),He=function(e){var t=e.ranks;return Object(O.jsx)(L.a,{display:"flex",children:t.map((function(e,t){return Object(O.jsxs)(L.a,{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",bgcolor:"orange",p:.3,border:"1px solid",children:[Object(O.jsx)(We.a,{sx:{width:30,height:30},src:"data:image/svg+xml;utf8,".concat(e.avatar)}),Object(O.jsx)(D.a,{variant:"body2",children:e.name})]},"rank_".concat(t))}))})},Xe=function(e){var t=e.data;return Object(O.jsxs)(L.a,{display:"flex",children:[Object(O.jsx)(Ve,{data:t,type:"stage"}),Object(O.jsx)(He,{ranks:t.ranks})]})},Ye=(n(380),n(216)),$e=n(125),Ke=n.n($e),Qe=n(166),Ze=n.n(Qe),et=function(){var e=E().axios,t=function(e,t){return t.filter((function(t){return parseInt(t.id)===e})).pop()},n=function(e){return"STAGE"===e.type?w:"LOGIC"===e.type?k:void 0},a=function(){var t=Object(d.a)(u.a.mark((function t(a){var c,r,i,o,s,l,d,j,b,p;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(c=a.node,r=a.currentNodeId,i=a.type,o=a.method,!(s=n(c))){t.next=21;break}return l=void 0,t.next=6,e.get("".concat(s+c.id,"/"));case 6:if(d=t.sent,j=d.data,"in"===i&&(l=j.in_stages),"out"===i&&(l=j.out_stages),!l){t.next=21;break}if(b=[],"create"===o&&(b=[r].concat(Object(Pe.a)(l))),"delete"===o&&(b=l.filter((function(e){return e!==r}))),p=void 0,"in"===i&&(p={in_stages:b}),"out"===i&&(p={out_stages:b}),!p){t.next=21;break}return console.log(p),t.next=21,e.patch("".concat(s+c.id,"/"),p);case 21:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),c=function(e,n,c){var r=t(e,c),i=t(n,c);r&&a({node:r,currentNodeId:n,type:"in",method:"delete"}),i&&a({node:i,currentNodeId:e,type:"out",method:"delete"})},r=function(){var t=Object(d.a)(u.a.mark((function t(a,c){var r,i,o;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r={name:a.label,x_pos:Math.round(a.position.x),y_pos:Math.round(a.position.y),chain:c,out_stages:[]},!(i=n(a))){t.next=7;break}return t.next=5,e.post(i,r).then((function(e){return e.data})).catch((function(e){return console.log(e)}));case 5:return o=t.sent,t.abrupt("return",o.id.toString());case 7:return t.abrupt("return",void 0);case 8:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}();return{getFormFields:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=Object(Ye.B)(e),a=Object(Ye.G)(n,"",e,t),c=function(e,t){return function e(n){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[""];return Object.keys(n).forEach((function(r){if("object"===typeof n[r]){var i=c.map((function(e){return"".concat(e,".").concat(r)}));n[r].__rjsf_additionalProperties&&""!==n[r].$name?a.push(n[r].$name):e(n[r],a,i)}else"$name"===r&&""!==n[r]&&c.forEach((function(e){e=e.replace(/^\./,"");var n=Ke()(t,e);("object"!==typeof n||Ze()(n))&&a.push(e)}))})),a}(e)};return c(a,t)},parseId:function(e){if(e)return parseInt(e);throw new Error("No id")},getNode:t,getUrl:n,updateConnections:a,addConnections:function(e,n,c){var r=t(e,c),i=t(n,c);r&&a({node:r,currentNodeId:n,type:"in",method:"create"}),i&&a({node:i,currentNodeId:e,type:"out",method:"create"})},removeConnections:c,removeElements:function(t,a){var r=t.map((function(e){return e.id}));return a.filter((function(t){if(r.includes(t.id)){if(Object(Ue.f)(t)){var i=parseInt(t.target),o=parseInt(t.source);c(i,o,a)}else{var s=n(t);s&&e.delete(s+t.id+"/")}return!1}return!0}))},updateNode:function(t){var a={x_pos:Math.round(t.position.x),y_pos:Math.round(t.position.y)},c=n(t);console.log(a),c&&e.patch(c+t.id+"/",a).then((function(e){return console.log(e.data)}))},createNode:r}},tt=n(631),nt=Object(V.a)(L.a)((function(e){var t=e.theme,n=e.type;return{fontSize:"12px",width:"150px",textAlign:"center",color:"stage"===n?t.palette.success.contrastText:t.palette.primary.contrastText,backgroundColor:"stage"===n?t.palette.success.main:t.palette.primary.main,padding:t.spacing(1),borderRadius:t.shape.borderRadius,cursor:"grab",margin:8}})),at=function(){var e=Object(a.useState)(!1),t=Object(j.a)(e,2),n=t[0],c=t[1],r=Object(a.useState)(""),i=Object(j.a)(r,2),o=i[0],s=i[1];Object(a.useEffect)((function(){c(!(!o||""===o))}),[o]);var l=function(e,t,n){var a=JSON.stringify({label:o,type:n});e.dataTransfer.setData("application/reactflow",a),e.dataTransfer.effectAllowed="move"},u=function(){s("")};return Object(O.jsxs)(F.a,{item:!0,container:!0,justifyContent:"center",px:1,children:[Object(O.jsxs)(F.a,{container:!0,item:!0,mt:2,justifyContent:"center",children:[Object(O.jsx)(tt.a,{label:"Label",size:"small",value:o,onChange:function(e){return s(e.target.value)}}),Object(O.jsx)(D.a,{py:1,variant:"caption",color:"red",align:"center",children:!n&&"Enter label to drag the node"})]}),Object(O.jsxs)(F.a,{item:!0,children:[Object(O.jsx)(nt,{type:"stage",onDragEnd:u,onDragStart:function(e){return l(e,0,"STAGE")},draggable:n,children:"Taskstage Node"}),Object(O.jsx)(nt,{type:"logic",onDragEnd:u,onDragStart:function(e){return l(e,0,"LOGIC")},draggable:n,children:"Conditional Node"})]})]})},ct=function(){var e=Object(a.useRef)(null),t=E(),n=t.getStageNodes,c=t.getLogicNodes,r=et(),i=r.parseId,o=r.addConnections,l=r.createNode,b=r.removeElements,p=r.updateNode,h=Object(s.j)(),f=h.campaignId,m=h.chainId,g=Object(a.useState)(null),x=Object(j.a)(g,2),v=x[0],y=x[1],C=Object(a.useState)([]),S=Object(j.a)(C,2),w=S[0],k=S[1],_=Object(s.i)(),N=i(f),I=i(m),L={style:{strokeWidth:3},arrowHeadType:"arrow"};Object(a.useEffect)((function(){Promise.all([n(N,I),c(N,I)]).then((function(e){var t=e[0],n=e[1];t.forEach((function(e){return e.type="STAGE"})),n.forEach((function(e){return e.type="LOGIC"}));var a=[].concat(Object(Pe.a)(t),Object(Pe.a)(n)),c=a.map((function(e){return{id:e.id.toString(),position:{x:parseFloat(e.x_pos),y:parseFloat(e.y_pos)},data:{label:e.name,ranks:e.ranks,conditions:e.conditions},type:e.type}}));return k(c),a})).then((function(e){e.forEach((function(e){e.in_stages.length>0&&e.in_stages.forEach((function(t){var n=Object(U.a)({source:t.toString(),target:e.id.toString(),id:"".concat(t,"-").concat(e.id)},L);k((function(e){return Object(Ue.d)(n,e)}))}))}))}))}),[I]);var D=function(){var e=Object(d.a)(u.a.mark((function e(t){var n,a,c;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=Object(U.a)(Object(U.a)({},t),L),a=parseInt(n.target),c=parseInt(n.source),k((function(e){return Object(Ue.d)(n,e)})),o(a,c,w);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),T=function(){var t=Object(d.a)(u.a.mark((function t(n){var a,c,r,i,o,s,d,j;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n.preventDefault(),a=e.current.getBoundingClientRect(),c=n.dataTransfer.getData("application/reactflow"),r=v.project({x:n.clientX-a.left,y:n.clientY-a.top}),i=JSON.parse(c),o=i.label,s=i.type,""!==o){t.next=9;break}return t.abrupt("return",0);case 9:return t.next=11,l({type:s,position:r,label:o},I);case 11:d=t.sent,j={id:d,type:s,position:r,data:{label:o}},k((function(e){return[].concat(Object(Pe.a)(e),[j])}));case 14:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),B=function(e,t){console.log(t),t.id&&("LOGIC"===t.type&&_("createlogic/".concat(t.id)),"STAGE"===t.type&&_("createstage/".concat(t.id)))},R={LOGIC:qe,STAGE:Xe};return Object(O.jsxs)(F.a,{container:!0,children:[Object(O.jsx)(F.a,{item:!0,md:10,zIndex:1,children:Object(O.jsx)(Ue.e,{ref:e,nodeTypes:R,elements:w,onConnect:D,onElementsRemove:function(e){k((function(t){return b(e,t)}))},onNodeDoubleClick:B,onEdgeDoubleClick:B,onLoad:function(e){return y(e)},onDrop:T,onDragOver:function(e){e.preventDefault(),e.dataTransfer.dropEffect="move"},onNodeDragStop:function(e,t){p(t)},preventScrolling:!0,style:{width:"94vw",height:"90vh"},children:Object(O.jsx)(Ue.a,{})})}),Object(O.jsx)(F.a,{item:!0,md:2,zIndex:2,height:200,sx:{background:"white"},children:Object(O.jsx)(at,{})})]})},rt=n(310),it=n.n(rt),ot=Object(V.a)(H.a)((function(e){var t=e.theme;return{color:t.palette.primary.contrastText,backgroundColor:t.palette.primary.main,"&:hover":{backgroundColor:t.palette.primary.dark}}})),st=function(e){var t=e.mode,n=e.allModes,a=e.onChange,c=e.onBack;return Object(O.jsxs)(L.a,{display:"flex",justifyContent:"flex-end",sx:{position:"sticky",top:60},p:1,zIndex:1,children:[Object(O.jsx)(L.a,{flex:1,children:Object(O.jsx)(Q.a,{title:"\u041d\u0430\u0437\u0430\u0434",children:Object(O.jsx)(ot,{onClick:c,children:Object(O.jsx)(it.a,{fontSize:"large"})})})}),Object(O.jsx)(G.a,{direction:"row",spacing:1,children:Object.keys(n).map((function(e){var c=t===e?"primary":"default",r=n[e].title,i=n[e].icon;return Object(O.jsx)(L.a,{children:Object(O.jsx)(Q.a,{title:r,children:Object(O.jsx)(H.a,{color:c,onClick:function(){return a(e)},children:i})})},e)}))})]})},lt=function(e){e.id,e.schema,e.options,e.value,e.required,e.disabled,e.readonly,e.label,e.onChange,e.onBlur,e.onFocus;return Object(O.jsx)("p",{children:"\u0417\u0434\u0435\u0441\u044c \u0431\u0443\u0434\u0435\u0442 \u0430\u0443\u0434\u0438\u043e"})},ut=n(26),dt=function(e){var t=e.id,n=e.placeholder,a=e.required,c=e.readonly,r=e.disabled,i=e.label,o=e.value,s=e.onChange,l=e.onBlur,u=e.onFocus,d=e.autofocus,j=e.options,b=e.schema,p=e.rawErrors,h=void 0===p?[]:p,f="string"===b.type?"text":"".concat(b.type);return Object(O.jsxs)(ut.a.Group,{className:"mb-0",children:[Object(O.jsxs)(ut.a.Label,{className:h.length>0?"text-danger":"",children:[i||b.title,(i||b.title)&&a?"*":null]}),Object(O.jsx)(ut.a.Control,{id:t,placeholder:n,autoFocus:d,required:a,disabled:r,readOnly:c,className:h.length>0?"is-invalid":"",list:b.examples?"examples_".concat(t):void 0,type:f,value:o||0===o?o:"",onChange:function(e){var t=e.target.value;return s(""===t?j.emptyValue:t)},onBlur:function(e){var n=e.target.value;return l(t,n)},onFocus:function(e){var n=e.target.value;return u(t,n)}}),b.examples?Object(O.jsx)("datalist",{id:"examples_".concat(t),children:b.examples.concat(b.default?[b.default]:[]).map((function(e){return Object(O.jsx)("option",{value:e},e)}))}):null]})},jt=function(e){var t=e.required,n=e.label,a=e.value,c=e.schema,r=e.rawErrors,i=void 0===r?[]:r;return a?Object(O.jsxs)(ut.a.Group,{className:"mb-0",children:[Object(O.jsxs)(ut.a.Label,{className:i.length>0?"text-danger":"",children:[n||c.title,(n||c.title)&&t?"*":null]}),Object(O.jsx)("br",{}),Object(O.jsx)("a",{href:a,children:a})]}):null},bt=function(e){var t=e.id,n=e.schema,a=e.options,c=e.value,r=e.required,i=e.disabled,o=e.readonly,s=e.label,l=e.onChange,u=e.onBlur,d=e.onFocus,j=a.enumOptions,b=a.enumDisabled,p=function(e){var t=e.target.value;return l("boolean"==n.type?"false"!==t:t)},h=function(e){var n=e.target.value;return u(t,n)},f=function(e){var n=e.target.value;return d(t,n)},m=Boolean(a&&a.inline);return Object(O.jsxs)(ut.a.Group,{className:"mb-0",children:[Object(O.jsxs)(ut.a.Label,{className:"d-block",children:[s||n.title,(s||n.title)&&r?"*":null]}),j.map((function(e,n){var a=Array.isArray(b)&&-1!==b.indexOf(e.value),s=e.value==c;return Object(O.jsx)(ut.a.Check,{inline:m,label:e.label,id:"".concat(t,"_").concat(e.label),name:t,type:"radio",disabled:i||a||o,checked:s,required:r,value:e.value,onChange:p,onBlur:h,onFocus:f},n)}))]})},pt=function(e){var t=e.required,n=e.label,a=e.formData,c=e.schema,r=e.onChange,i=e.rawErrors,o=void 0===i?[]:i,s=function(e){var t=Array.isArray(a)?a:[];if("add"===e){var n=[].concat(Object(Pe.a)(t),[(new Date).toISOString()]);r(n)}else if("remove"===e){var c=Object(Pe.a)(t);c.pop(),r(c)}};return Object(O.jsxs)(ut.a.Group,{className:"mb-0",children:[Object(O.jsxs)(ut.a.Label,{className:o.length>0?"text-danger":"",children:[n||c.title,(n||c.title)&&t?"*":null]}),Object(O.jsx)("br",{}),Object(O.jsxs)(L.a,{display:"flex",height:80,children:[Object(O.jsx)(D.a,{variant:"h2",pr:1,children:Array.isArray(a)?a.length:0}),Object(O.jsx)(R.a,{fullWidth:!0,variant:"contained",onClick:function(){return s("add")},children:"+"}),Object(O.jsx)(R.a,{variant:"contained",color:"warning",onClick:function(){return s("remove")},children:"-"})]})]})},ht=n(633),ft=function(e){var t=e.id,n=e.placeholder,a=e.required,c=(e.readonly,e.disabled),r=e.label,i=e.value,o=e.onChange,s=e.onBlur,l=e.onFocus,u=e.autofocus,d=e.options,j=e.schema,b=e.rawErrors,p=void 0===b?[]:b;"string"===j.type||"".concat(j.type);return Object(O.jsxs)(ut.a.Group,{className:"mb-0",children:[Object(O.jsxs)(ut.a.Label,{className:p.length>0?"text-danger":"",children:[r||j.title,(r||j.title)&&a?"*":null]}),Object(O.jsx)(ht.a,{placeholder:n,disabled:c,value:i||0===i?i:"",onChange:function(e,t,n){return o(""===t?d.emptyValue:t)},onBlur:function(e){var n=e.target.value;return s(t,n)},style:{width:"100%"},onFocus:function(e){var n=e.target.value;return l(t,n)},disablePortal:!0,id:t,options:j.enum.concat(j.default?[j.default]:[]),sx:{width:300},renderInput:function(e){return Object(O.jsx)(tt.a,Object(U.a)(Object(U.a)({required:a,autoFocus:u},e),{},{error:p.length>0,hiddenLabel:!0,label:"option",size:"small"}))}})]})},Ot=function(e){return Object(O.jsx)("p",{children:"\u0417\u0434\u0435\u0441\u044c \u0431\u0443\u0434\u0435\u0442 webhook trigger"})},mt=n(325),gt=(n(295),function(e){var t=e.schema,n=e.uiSchema,a=e.formData,c=e.hideButton,r=e.onChange,i=e.onSubmit,o={customfile:lt,autocomplete:dt,RadioWidget:bt,customlink:jt,audio:lt,simple_autocomplete:ft,webhook:Ot},s={counter:pt};return Object(O.jsx)(mt.a,{schema:t,uiSchema:n,formData:a,widgets:o,fields:s,onChange:function(e){if(!r)return 0;r(e.formData)},onSubmit:function(e){if(!i)return 0;i(e.formData)},children:c?" ":Object(O.jsx)("button",{type:"submit",className:"btn btn-primary",children:"\u041e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c"})})}),xt=n(312),vt=n(18),yt={audio:{displayName:"Audio",matchIf:[{types:["string"],widget:"audio"}],possibleOptions:["private","default","readonly"],defaultDataSchema:{},defaultUiSchema:{"ui:widget":"audio","ui:options":{private:!1,default:""}},type:"string",cardBody:function(e){var t,n,a,c,r=e.parameters,i=e.onChange;return Object(O.jsxs)("div",{children:[Object(O.jsxs)("div",{style:{display:"flex",justifyContent:"center",alignItems:"baseline",padding:"0 10px"},children:[Object(O.jsx)("h5",{style:{padding:"0 5px"},children:"Private Upload"}),Object(O.jsx)("input",{checked:null===(t=r["ui:options"])||void 0===t?void 0:t.private,type:"checkbox",onChange:function(e){return i(Object(U.a)(Object(U.a)({},r),{},{"ui:options":Object(U.a)(Object(U.a)({},r["ui:options"]),{},{private:e.target.checked})}))},className:"card-text"}),Object(O.jsx)("h5",{style:{padding:"0 5px"},children:"Read only"}),Object(O.jsx)("input",{checked:null===(n=r["ui:options"])||void 0===n?void 0:n.readonly,type:"checkbox",onChange:function(e){return i(Object(U.a)(Object(U.a)({},r),{},{"ui:options":Object(U.a)(Object(U.a)({},r["ui:options"]),{},{readonly:e.target.checked})}))},className:"card-text"})]}),Object(O.jsx)("h5",{children:"Default Audio (Link)"}),Object(O.jsx)(vt.f,{value:null!==(a=null===(c=r["ui:options"])||void 0===c?void 0:c.default)&&void 0!==a?a:"",placeholder:"Default",type:"text",onChange:function(e){return i(Object(U.a)(Object(U.a)({},r),{},{"ui:options":Object(U.a)(Object(U.a)({},r["ui:options"]),{},{default:e.target.value})}))},className:"card-text"})]})}}},Ct={autocomplete:{displayName:"AutoComplete",matchIf:[{types:["string"],widget:"autocomplete"}],possibleOptions:["webhook","params","searchField","responseField"],defaultDataSchema:{},defaultUiSchema:{"ui:widget":"autocomplete","ui:options":{webhook:"",params:"",searchField:"",responseField:""}},type:"string",cardBody:function(e){var t,n,a,r,i=e.parameters,o=e.onChange;return Object(O.jsxs)(c.a.Fragment,{children:[Object(O.jsx)("h5",{children:"Webhook"}),Object(O.jsx)(vt.f,{value:null===(t=i["ui:options"])||void 0===t?void 0:t.webhook,placeholder:"Webhook",type:"text",onChange:function(e){return o(Object(U.a)(Object(U.a)({},i),{},{"ui:options":Object(U.a)(Object(U.a)({},i["ui:options"]),{},{webhook:e.target.value})}))},className:"card-text"}),Object(O.jsx)("br",{}),Object(O.jsx)("h5",{children:"Params"}),Object(O.jsx)(vt.f,{value:null===(n=i["ui:options"])||void 0===n?void 0:n.params,placeholder:"Params",type:"text",onChange:function(e){return o(Object(U.a)(Object(U.a)({},i),{},{"ui:options":Object(U.a)(Object(U.a)({},i["ui:options"]),{},{params:e.target.value})}))},className:"card-text"}),Object(O.jsx)("br",{}),Object(O.jsxs)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center"},children:[Object(O.jsxs)("div",{style:{width:"100%",paddingRight:7},children:[Object(O.jsx)("h5",{children:"Search Field"}),Object(O.jsx)(vt.f,{value:null===(a=i["ui:options"])||void 0===a?void 0:a.searchField,placeholder:"Search Field",type:"text",onChange:function(e){return o(Object(U.a)(Object(U.a)({},i),{},{"ui:options":Object(U.a)(Object(U.a)({},i["ui:options"]),{},{searchField:e.target.value})}))},className:"card-text"})]}),Object(O.jsxs)("div",{style:{width:"100%",paddingLeft:7},children:[Object(O.jsx)("h5",{children:"Response Field"}),Object(O.jsx)(vt.f,{value:null===(r=i["ui:options"])||void 0===r?void 0:r.responseField,placeholder:"Response Field",type:"text",onChange:function(e){return o(Object(U.a)(Object(U.a)({},i),{},{"ui:options":Object(U.a)(Object(U.a)({},i["ui:options"]),{},{responseField:e.target.value})}))},className:"card-text"})]})]})]})}}},St={file:{displayName:"File",matchIf:[{types:["string"],widget:"customfile"}],possibleOptions:["private","multiple"],defaultDataSchema:{},defaultUiSchema:{"ui:widget":"customfile","ui:options":{private:!1,multiple:!1}},type:"string",cardBody:function(e){var t,n,a=e.parameters,c=e.onChange;return Object(O.jsxs)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center"},children:[Object(O.jsxs)("div",{style:{display:"flex",alignItems:"baseline",padding:"0 10px"},children:[Object(O.jsx)("h5",{style:{padding:"0 5px"},children:"Private Upload"}),Object(O.jsx)("input",{checked:null===(t=a["ui:options"])||void 0===t?void 0:t.private,type:"checkbox",onChange:function(e){return c(Object(U.a)(Object(U.a)({},a),{},{"ui:options":Object(U.a)(Object(U.a)({},a["ui:options"]),{},{private:e.target.checked})}))},className:"card-text"})]}),Object(O.jsxs)("div",{style:{display:"flex",alignItems:"baseline",padding:"0 10px"},children:[Object(O.jsx)("h5",{style:{padding:"0 5px"},children:"Multiple Files"}),Object(O.jsx)("input",{checked:null===(n=a["ui:options"])||void 0===n?void 0:n.multiple,type:"checkbox",onChange:function(e){return c(Object(U.a)(Object(U.a)({},a),{},{"ui:options":Object(U.a)(Object(U.a)({},a["ui:options"]),{},{multiple:e.target.checked})}))},className:"card-text"})]})]})}}},wt={link:{displayName:"Link",matchIf:[{types:["string"],widget:"customlink"}],defaultDataSchema:{},defaultUiSchema:{"ui:widget":"customlink"},type:"string",cardBody:function(e){var t,n=e.parameters,a=e.onChange;return Object(O.jsxs)(c.a.Fragment,{children:[Object(O.jsx)("h5",{children:"Default value"}),Object(O.jsx)(vt.f,{value:null!==(t=n.default)&&void 0!==t?t:"",placeholder:"Default",type:"text",onChange:function(e){return a(Object(U.a)(Object(U.a)({},n),{},{default:e.target.value}))},className:"card-text"})]})}}},kt={counter:{displayName:"Counter",matchIf:[{types:["array"],field:"counter"}],defaultDataSchema:{items:{type:"string",format:"date-time"}},defaultUiSchema:{"ui:field":"counter"},type:"array"}};var _t={longAnswer:{displayName:"Long Answer",matchIf:[{types:["string"],widget:"textarea"}],possibleOptions:["rows"],defaultDataSchema:{},defaultUiSchema:{"ui:widget":"textarea"},type:"string",cardBody:function(e){var t=e.parameters,n=e.onChange;return Object(O.jsxs)(c.a.Fragment,{children:[Object(O.jsx)("h5",{children:"Default value"}),Object(O.jsx)(vt.f,{value:t.default,placeholder:"Default",type:"textarea",onChange:function(e){return n(Object(U.a)(Object(U.a)({},t),{},{default:e.target.value}))},className:"card-textarea"})]})},modalBody:function(e){var t,n,a=e.parameters,c=e.onChange;return Object(O.jsxs)("div",{children:[Object(O.jsx)("h4",{children:"Minimum Length"}),Object(O.jsx)(vt.f,{value:a.minLength?a.minLength:"",placeholder:"Minimum Length",type:"number",onChange:function(e){c(Object(U.a)(Object(U.a)({},a),{},{minLength:parseInt(e.target.value,10)}))},className:"card-modal-number"},"minLength"),Object(O.jsx)("h4",{children:"Maximum Length"}),Object(O.jsx)(vt.f,{value:a.maxLength?a.maxLength:"",placeholder:"Maximum Length",type:"number",onChange:function(e){c(Object(U.a)(Object(U.a)({},a),{},{maxLength:parseInt(e.target.value,10)}))},className:"card-modal-number"},"maxLength"),Object(O.jsx)("h4",{children:"Rows"}),Object(O.jsx)(vt.f,{value:null!==(t=null===(n=a["ui:options"])||void 0===n?void 0:n.rows)&&void 0!==t?t:0,placeholder:"Rows",type:"number",onChange:function(e){c(Object(U.a)(Object(U.a)({},a),{},{"ui:options":{rows:parseInt(e.target.value,10)}}))},className:"card-modal-number"},"rows"),Object(O.jsxs)("h4",{children:["Regular Expression Pattern"," ",Object(O.jsx)("a",{href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Regular_Expressions"})]}),Object(O.jsx)(vt.f,{value:a.pattern?a.pattern:"",placeholder:"Regular Expression Pattern",type:"text",onChange:function(e){c(Object(U.a)(Object(U.a)({},a),{},{pattern:e.target.value}))},className:"card-modal-text"},"pattern"),Object(O.jsxs)("div",{className:"card-modal-boolean",children:[Object(O.jsx)("p",{children:"Auto Focus"}),Object(O.jsx)("input",{type:"checkbox",onChange:function(){c(Object(U.a)(Object(U.a)({},a),{},{"ui:autofocus":!a["ui:autofocus"]||!0!==a["ui:autofocus"]}))},checked:!!a["ui:autofocus"]&&!0===a["ui:autofocus"]})]})]})}}},Nt={card:{displayName:"Card",matchIf:[{types:["object"],widget:"card"}],defaultDataSchema:{subtype:"card"},defaultUiSchema:{},type:"object"}},It={reader:{displayName:"Reader",matchIf:[{types:["array"],widget:"reader"}],defaultDataSchema:{items:{type:"object",properties:{word:{default:"Some word",type:"string",readOnly:!0},translation:{default:"\u041a\u0430\u043a\u043e\u0435-\u0442\u043e \u0441\u043b\u043e\u0432\u043e",type:"string",readOnly:!0},count:{title:"\u041a\u043e\u043b-\u0432\u043e \u043d\u0430\u0436\u0430\u0442\u0438\u0439",default:0,type:"integer",readOnly:!0},active:{title:"\u0410\u043a\u0442\u0438\u0432\u0435\u043d",type:"boolean"}}}},defaultUiSchema:{"ui:widget":"reader"},type:"array"}},Et=n(171),Lt=(n(554),function(e){var t=e.data,n=e.onChange;return Object(O.jsx)(Et.a,{id:"EditorTinyMCE",onEditorChange:function(e,t){n(e)},value:t,tinymceScriptSrc:"/gigaturnip-frontend/tinymce/tinymce.min.js",init:{plugins:"autosave save print preview paste importcss searchreplace autolink directionality code visualblocks visualchars fullscreen image link media template codesample table charmap hr pagebreak nonbreaking anchor toc insertdatetime advlist lists wordcount imagetools textpattern noneditable help charmap emoticons autoresize",menubar:"file edit view insert format tools table help",toolbar:"undo redo | bold italic underline strikethrough | fontselect fontsizeselect formatselect | alignleft aligncenter alignright alignjustify | outdent indent |  numlist bullist | forecolor backcolor removeformat | pagebreak | charmap emoticons | fullscreen  preview save print | insertfile image media link anchor codesample | ltr rtl",toolbar_sticky:!0,image_advtab:!0,importcss_append:!0,image_caption:!0,noneditable_noneditable_class:"mceNonEditable",toolbar_mode:"sliding",contextmenu:"link image imagetools table",autosave_prefix:"tinymce-autosave-{path}{query}-",content_style:"body { font-family:Helvetica,Arial,sans-serif; font-size:14px }"}})});var Dt={editor:{displayName:"Editor",matchIf:[{types:["string"],widget:"editor"}],possibleOptions:["readonly"],defaultDataSchema:{},defaultUiSchema:{"ui:widget":"editor"},type:"string",cardBody:function(e){var t,n,a=e.parameters,r=e.onChange;return Object(O.jsxs)(c.a.Fragment,{children:[Object(O.jsx)("h5",{children:"Read only"}),Object(O.jsx)(vt.f,{type:"checkbox",checked:null!==(t=null===(n=a["ui:options"])||void 0===n?void 0:n.readonly)&&void 0!==t&&t,onChange:function(e){r(Object(U.a)(Object(U.a)({},a),{},{"ui:options":{readonly:e.target.checked}}))}}),Object(O.jsx)("h5",{children:"Default value"}),Object(O.jsx)(Lt,{data:a.default,onChange:function(e){return r(Object(U.a)(Object(U.a)({},a),{},{default:e}))}})]})}}},Ft=n(49),Tt=n(35),Bt=n(129),Rt=Object(Ft.a)({cardEnumOption:{width:"100%",display:"flex",flexDirection:"row",marginBottom:".5em","& input":{width:"80%",marginRight:"1em",marginBottom:0},"& .delete-button":{display:"flex",flexDirection:"column",justifyContent:"center"}}});function At(e){for(var t=e.initialValues,n=e.onChange,a=Rt(),r=[],i=function(e){var c=t[e];r.push(Object(O.jsxs)("div",{className:a.cardEnumOption,children:[Object(O.jsx)(vt.f,{value:void 0===c||null===c?"":c,placeholder:"Value",type:"text",onChange:function(a){var c=a.target.value;n([].concat(Object(Pe.a)(t.slice(0,e)),[c],Object(Pe.a)(t.slice(e+1))))},className:"card-text"},"val-".concat(e)),Object(O.jsx)("div",{className:"delete-button",children:Object(O.jsx)(Bt.a,{icon:Tt.j,onClick:function(){n([].concat(Object(Pe.a)(t.slice(0,e)),Object(Pe.a)(t.slice(e+1))))}})})]},e))},o=0;o<t.length;o+=1)i(o);return Object(O.jsxs)(c.a.Fragment,{children:[Object(O.jsx)("h5",{children:"Examples"}),r,Object(O.jsx)("div",{style:{display:"flex",padding:4},children:Object(O.jsx)(Bt.a,{icon:Tt.g,onClick:function(){n([].concat(Object(Pe.a)(t),[""]))}})})]})}var Pt={shortAnswer:{displayName:"Short Answer",matchIf:[{types:["string"]}],possibleOptions:[],defaultDataSchema:{},type:"string",cardBody:function(e){var t=e.parameters,n=e.onChange,a=Array.isArray(t.examples)?t.examples:[],r=t.default;return Object(O.jsxs)(c.a.Fragment,{children:[Object(O.jsx)("h5",{children:"Default value"}),Object(O.jsx)(vt.f,{value:void 0===r||null===r?"":r,placeholder:"Default",onChange:function(e){return n(Object(U.a)(Object(U.a)({},t),{},{default:e.target.value}))},className:"card-text"}),Object(O.jsx)("br",{}),Object(O.jsx)(At,{initialValues:a,onChange:function(e){return n(Object(U.a)(Object(U.a)({},t),{},{examples:0===e.length?void 0:e}))}})]})},modalBody:function(e){var t=e.parameters,n=e.onChange;return Object(O.jsxs)("div",{children:[Object(O.jsx)("h4",{children:"Minimum Length"}),Object(O.jsx)(vt.f,{value:t.minLength?t.minLength:"",placeholder:"Minimum Length",type:"number",onChange:function(e){n(Object(U.a)(Object(U.a)({},t),{},{minLength:parseInt(e.target.value,10)}))},className:"card-modal-number"},"minLength"),Object(O.jsx)("h4",{children:"Maximum Length"}),Object(O.jsx)(vt.f,{value:t.maxLength?t.maxLength:"",placeholder:"Maximum Length",type:"number",onChange:function(e){n(Object(U.a)(Object(U.a)({},t),{},{maxLength:parseInt(e.target.value,10)}))},className:"card-modal-number"},"maxLength"),Object(O.jsxs)("h4",{children:["Regular Expression Pattern"," ",Object(O.jsx)("a",{href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Regular_Expressions"})]}),Object(O.jsx)(vt.f,{value:t.pattern?t.pattern:"",placeholder:"Regular Expression Pattern",type:"text",onChange:function(e){n(Object(U.a)(Object(U.a)({},t),{},{pattern:e.target.value}))},className:"card-modal-text"},"pattern"),Object(O.jsxs)("div",{className:"card-modal-boolean",children:[Object(O.jsx)("p",{children:"Auto Focus"}),Object(O.jsx)("input",{type:"checkbox",onChange:function(){n(Object(U.a)(Object(U.a)({},t),{},{"ui:autofocus":!t["ui:autofocus"]||!0!==t["ui:autofocus"]}))},checked:!!t["ui:autofocus"]&&!0===t["ui:autofocus"]})]})]})}}};var Ut={simpleAutoComplete:{displayName:"Simple AutoComplete",matchIf:[{types:["string"],widget:"simple_autocomplete",enum:!0}],possibleOptions:[],defaultDataSchema:{enum:[]},defaultUiSchema:{"ui:widget":"simple_autocomplete"},type:"string",cardBody:function(e){var t=e.parameters,n=e.onChange,a=Array.isArray(t.enum)?t.enum:[],r=t.default;return Object(O.jsxs)(c.a.Fragment,{children:[Object(O.jsx)("h5",{children:"Default value"}),Object(O.jsx)(vt.f,{value:void 0===r||null===r?"":r,placeholder:"Default",onChange:function(e){return n(Object(U.a)(Object(U.a)({},t),{},{default:e.target.value}))},className:"card-text"}),Object(O.jsx)("br",{}),Object(O.jsx)(At,{initialValues:a,onChange:function(e){return n(Object(U.a)(Object(U.a)({},t),{},{enum:0===e.length?[]:e}))}})]})},modalBody:function(e){var t=e.parameters,n=e.onChange;return Object(O.jsxs)("div",{children:[Object(O.jsx)("h4",{children:"Minimum Length"}),Object(O.jsx)(vt.f,{value:t.minLength?t.minLength:"",placeholder:"Minimum Length",type:"number",onChange:function(e){n(Object(U.a)(Object(U.a)({},t),{},{minLength:parseInt(e.target.value,10)}))},className:"card-modal-number"},"minLength"),Object(O.jsx)("h4",{children:"Maximum Length"}),Object(O.jsx)(vt.f,{value:t.maxLength?t.maxLength:"",placeholder:"Maximum Length",type:"number",onChange:function(e){n(Object(U.a)(Object(U.a)({},t),{},{maxLength:parseInt(e.target.value,10)}))},className:"card-modal-number"},"maxLength"),Object(O.jsxs)("h4",{children:["Regular Expression Pattern"," ",Object(O.jsx)("a",{href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Regular_Expressions"})]}),Object(O.jsx)(vt.f,{value:t.pattern?t.pattern:"",placeholder:"Regular Expression Pattern",type:"text",onChange:function(e){n(Object(U.a)(Object(U.a)({},t),{},{pattern:e.target.value}))},className:"card-modal-text"},"pattern"),Object(O.jsxs)("div",{className:"card-modal-boolean",children:[Object(O.jsx)("p",{children:"Auto Focus"}),Object(O.jsx)("input",{type:"checkbox",onChange:function(){n(Object(U.a)(Object(U.a)({},t),{},{"ui:autofocus":!t["ui:autofocus"]||!0!==t["ui:autofocus"]}))},checked:!!t["ui:autofocus"]&&!0===t["ui:autofocus"]})]})]})}}},zt={webhook:{displayName:"Webhook Trigger",matchIf:[{types:["string"],widget:"webhook"}],possibleOptions:["label"],defaultDataSchema:{},defaultUiSchema:{"ui:widget":"webhook","ui:options":{label:""}},type:"string",cardBody:function(e){var t,n=e.parameters,a=e.onChange;return Object(O.jsxs)(c.a.Fragment,{children:[Object(O.jsx)("h5",{children:"Button label"}),Object(O.jsx)(vt.f,{value:null===(t=n["ui:options"])||void 0===t?void 0:t.label,placeholder:"Button label",type:"text",onChange:function(e){return a(Object(U.a)(Object(U.a)({},n),{},{"ui:options":Object(U.a)(Object(U.a)({},n["ui:options"]),{},{label:e.target.value})}))},className:"card-text"})]})}}},Mt=Object(U.a)(Object(U.a)(Object(U.a)(Object(U.a)(Object(U.a)(Object(U.a)(Object(U.a)(Object(U.a)(Object(U.a)(Object(U.a)(Object(U.a)(Object(U.a)({},yt),Ct),St),wt),kt),_t),Nt),It),Dt),Pt),Ut),zt),Gt=n(326),Jt=function(e){var t=e.schema,n=e.uiSchema,a=e.onChange,c=Mt;return Object(O.jsx)(Gt.a,{schema:t,uischema:n,onChange:function(e,t){a(e,t)},mods:{customFormInputs:c}})},qt=Object(V.a)(L.a)((function(){return{width:"70%",minWidth:"400px",margin:"0 auto"}})),Wt=function(e){var t=e.schema,n=e.uiSchema,a=e.formData,c=e.onSchemaChange,r=e.onFormDataChange,i=Object(U.a)({},xt);return Object(O.jsxs)(L.a,{p:1,children:[Object(O.jsx)(Jt,{schema:t,uiSchema:n,onChange:c}),Object(O.jsx)(qt,{children:Object(O.jsx)(gt,{schema:i,uiSchema:{displayed_prev_stages:{"ui:widget":"checkboxes"}},formData:a,onChange:r,hideButton:!0})})]})},Vt=function(e){var t=e.data;return Object(O.jsx)(Et.a,{id:"ViewerTinyMCE",value:t,toolbar:!1,inline:!1,disabled:!0,tinymceScriptSrc:"/gigaturnip-frontend/tinymce/tinymce.min.js",init:{plugins:"autoresize",menubar:!1,image_advtab:!0,importcss_append:!0}})},Ht=function(e){var t=e.schema,n=e.uiSchema,a=e.text;return Object(O.jsxs)(qt,{children:[a&&Object(O.jsx)(Vt,{data:a}),Object(O.jsx)(L.a,{py:1,children:Object(O.jsx)(gt,{schema:t,uiSchema:n})})]})},Xt=n(662),Yt=n(663),$t=n(664),Kt=function(e){var t=e.isEditable,n=e.schema,a=e.ui,c=e.onSchemaChange,r=e.onUiChange,i=e.onIsEditableChange,o=e.onSave,s=e.onUndo,l=n,u=a;try{var d=JSON.parse(n);l=JSON.stringify(d,null,2);var j=JSON.parse(a);u=JSON.stringify(j,null,2)}catch(b){console.log(b)}return Object(O.jsxs)(L.a,{children:[Object(O.jsxs)(F.a,{container:!0,alignItems:"center",children:[Object(O.jsx)(Xt.a,{sx:{my:1},children:Object(O.jsx)(Yt.a,{control:Object(O.jsx)($t.a,{checked:t,onChange:function(){i()},name:"edit",inputProps:{"aria-label":"edit"}}),labelPlacement:"start",label:"\u0420\u0435\u0434\u0430\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c"})}),t&&Object(O.jsx)(R.a,{sx:{m:1},color:"primary",variant:"contained",onClick:function(){o()},children:"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u044f"}),t&&Object(O.jsx)(R.a,{sx:{m:1},color:"primary",variant:"contained",onClick:function(){s()},children:"\u041e\u0442\u043c\u0435\u043d\u0438\u0442\u044c \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u044f"})]}),Object(O.jsxs)(F.a,{container:!0,children:[Object(O.jsx)(F.a,{item:!0,xs:12,md:6,p:1,children:Object(O.jsx)(tt.a,{label:"Schema",multiline:!0,fullWidth:!0,variant:"outlined",InputProps:{readOnly:!t},value:l,onChange:function(e){c(e.target.value)},style:{marginTop:15,marginBottom:15}})}),Object(O.jsx)(F.a,{item:!0,xs:12,md:6,p:1,children:Object(O.jsx)(tt.a,{label:"Ui",multiline:!0,fullWidth:!0,variant:"outlined",InputProps:{readOnly:!t},value:u,onChange:function(e){r(e.target.value)},style:{marginTop:15,marginBottom:30}})})]})]})},Qt=n(315),Zt=function(e){var t=e.id,n=E().getTaskStageOptions,c=Object(a.useState)({}),r=Object(j.a)(c,2),i=r[0],o=r[1],s=function(){var e=Object(d.a)(u.a.mark((function e(){var t;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n();case 2:if(!(t=e.sent)){e.next=7;break}return e.abrupt("return",t.actions.POST);case 7:return e.abrupt("return",void 0);case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),l=function(e){var t=["string","number","integer","boolean","null"],n=e?Object.keys(e):[],a={},c=[];n.forEach((function(n){var r=e[n],i=r.type,o=r.label,s=r.help_text,l=r.required;t.includes(i)?(a[n]={type:i,title:o,description:s},l&&c.push(n)):"decimal"===i&&(a[n]={type:"number",title:o,description:s},l&&c.push(n))}));var r={type:"object",properties:a,required:c};return console.log(r),r};return Object(a.useEffect)((function(){t&&function(){var e=Object(d.a)(u.a.mark((function e(){var t,n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s();case 2:t=e.sent,n=l(t),o(n);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()()}),[t]),Object(O.jsx)("div",{children:Object(O.jsx)(gt,{schema:i})})},en=function(e){Object(Qt.a)(e);return Object(O.jsx)(qt,{children:Object(O.jsx)(F.a,{container:!0,py:2,spacing:2,children:[1,2].map((function(e,t){return Object(O.jsx)(F.a,{item:!0,xs:12,children:Object(O.jsx)($,{data:{name:e},hideOpenButton:!0,children:Object(O.jsx)(Zt,{id:e})})},t)}))})})},tn=function(e){var t=e.data,n=e.onChange;return Object(O.jsx)(qt,{children:Object(O.jsx)(Lt,{data:t,onChange:n})})},nn=n(635),an=n(637),cn=c.a.createContext(null),rn=c.a.forwardRef((function(e,t){return Object(O.jsx)(nn.a,Object(U.a)({elevation:6,ref:t,variant:"filled"},e))})),on=function(e){var t=e.children,n=Object(a.useState)(!1),c=Object(j.a)(n,2),r=c[0],i=c[1],o=Object(a.useState)(""),s=Object(j.a)(o,2),l=s[0],u=s[1],d=Object(a.useState)("error"),b=Object(j.a)(d,2),p=b[0],h=b[1],f=function(e,t){"clickaway"!==t&&i(!1)},m={open:r,openToast:function(e,t){t&&h(t),u(function(e){switch(typeof e){case"string":return e;case"object":return JSON.stringify(e);default:return String(e)}}(e)),i(!0)},closeToast:f};return Object(O.jsxs)(cn.Provider,{value:m,children:[Object(O.jsx)(an.a,{open:r,autoHideDuration:5e3,onClose:f,anchorOrigin:{vertical:"top",horizontal:"center"},children:Object(O.jsx)(rn,{onClose:f,severity:p,sx:{width:"100%"},children:l})}),t]})},sn=function(){return c.a.useContext(cn)},ln=n(317),un=n.n(ln),dn=n(319),jn=n.n(dn),bn=n(320),pn=n.n(bn),hn=n(321),fn=n.n(hn),On=n(316),mn=n.n(On);function gn(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=Object(a.useContext)(s.f),c=n.navigator;Object(a.useEffect)((function(){if(t){var n=c.block((function(t){var a=Object(U.a)(Object(U.a)({},t),{},{retry:function(){n(),setTimeout((function(){return t.retry()}),100)}});e(a)}));return n}}),[c,e,t])}var xn=function(e){var t=e.schema,n=e.uiSchema,a=e.onSchemaChange,c=e.onUseMainSchema;return Object(O.jsxs)(L.a,{p:1,children:[Object(O.jsx)(L.a,{display:"flex",justifyContent:"center",children:Object(O.jsx)(R.a,{variant:"contained",onClick:c,children:"\u0418\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u0433\u043b\u0430\u0432\u043d\u0443\u044e \u0441\u0445\u0435\u043c\u0443"})}),Object(O.jsx)(Jt,{schema:t,uiSchema:n,onChange:a})]})},vn=n(318),yn=n.n(vn),Cn=["id","json_schema","ui_schema","rich_text","webhook_address","webhook_params","card_json_schema","card_ui_schema"],Sn=["chain","webhook_params"],wn=function(){var e=Object(s.j)().stageId,t=Object(s.i)(),n=E(),c=n.getTaskStage,r=n.saveTaskStage,i=(0,et().parseId)(e),o=sn().openToast,l=Object(a.useState)(""),b=Object(j.a)(l,2),p=b[0],h=b[1],f=Object(a.useState)(""),m=Object(j.a)(f,2),g=m[0],x=m[1],v=Object(a.useState)({}),y=Object(j.a)(v,2),C=y[0],S=y[1],w=Object(a.useState)("builder"),k=Object(j.a)(w,2),_=k[0],N=k[1],I=Object(a.useState)(""),D=Object(j.a)(I,2),F=D[0],T=D[1],B=Object(a.useState)(!1),A=Object(j.a)(B,2),P=A[0],M=A[1],G=Object(a.useState)(""),J=Object(j.a)(G,2),q=J[0],W=J[1],V=Object(a.useState)(""),H=Object(j.a)(V,2),X=H[0],Y=H[1],$=Object(a.useState)(""),K=Object(j.a)($,2),Q=K[0],Z=K[1],ee=Object(a.useState)(""),te=Object(j.a)(ee,2),ne=te[0],ae=te[1],ce=Object(a.useState)(!1),re=Object(j.a)(ce,2),ie=re[0],oe=re[1],se=Object(a.useState)(""),le=Object(j.a)(se,2),ue=le[0],de=le[1],je=Object(a.useState)(""),be=Object(j.a)(je,2),pe=be[0],he=be[1];!function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];gn(Object(a.useCallback)((function(t){var n;"function"===typeof e?"string"===typeof(n=e(t.location,t.action))&&(n=window.confirm(n)):n=window.confirm(e),n&&t.retry()}),[e]),t)}("\u0412\u044b \u0443\u0432\u0435\u0440\u0435\u043d\u044b, \u0447\u0442\u043e \u0445\u043e\u0442\u0438\u0442\u0435 \u043f\u043e\u043a\u0438\u043d\u0443\u0442\u044c \u044d\u0442\u0443 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0443?",ie);var fe=p?JSON.parse(p):{},Oe=g?JSON.parse(g):{},me={builder:{title:"\u041a\u043e\u043d\u0441\u0442\u0440\u0443\u043a\u0442\u043e\u0440",icon:Object(O.jsx)(un.a,{fontSize:"large"})},card:{title:"Card Data",icon:Object(O.jsx)(yn.a,{fontSize:"large"})},text:{title:"\u0422\u0435\u043a\u0441\u0442",icon:Object(O.jsx)(jn.a,{fontSize:"large"})},preview:{title:"\u041f\u0440\u0435\u0432\u044c\u044e",icon:Object(O.jsx)(pn.a,{fontSize:"large"})},editor:{title:"\u0421\u0445\u0435\u043c\u044b",icon:Object(O.jsx)(fn.a,{fontSize:"large"})}};Object(a.useEffect)((function(){i&&function(){var e=Object(d.a)(u.a.mark((function e(t){var n,a,r,i,o,s,l,d,j;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c(t);case 2:n=e.sent,n.id,a=n.json_schema,r=n.ui_schema,i=n.rich_text,o=n.webhook_address,s=n.webhook_params,l=n.card_json_schema,d=n.card_ui_schema,(j=Object(z.a)(n,Cn)).webhook_address=o||void 0,j.webhook_params=s?JSON.stringify(s):void 0,h(a),x(r),W(a),Y(r),Z(a),ae(r),S(j),T(i),de(l),he(d);case 16:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()(i)}),[i]);var ge=Object(a.useCallback)((function(){C.chain;var e,t=C.webhook_params,n=Object(z.a)(C,Sn);try{e=JSON.parse(t)}catch(a){e=null}return Object(U.a)(Object(U.a)({},n),{},{json_schema:p,ui_schema:g,rich_text:F,card_json_schema:ue,card_ui_schema:pe,webhook_params:e})}),[C,p,F,g,ue,pe]),xe=function(e){return r(i,e)},ve=Object(a.useCallback)(mn()((function(e){xe(e).then((function(){return console.log("saved")})).catch((function(e){return o(e.message,"error")}))}),2e3),[]);Object(a.useEffect)((function(){oe(!0)}),[C,p,g,F,ve,ge]);var ye=function(e,t){h(e),x(t),Z(e),ae(t),W(e),Y(t)},Ce=function(e,t){de(e),he(t)},Se=function(e){S(e)},we=function(e){T(e)},ke=function(){M(!P)},_e=function(e){W(e)},Ne=function(e){Y(e)},Ie=function(){h(q),x(X)},Ee=function(){h(Q),x(ne),W(Q),Y(ne)},Le=function(){de(p),he(g)};return Object(O.jsxs)(L.a,{children:[Object(O.jsx)(st,{allModes:me,mode:_,onChange:function(e){N(e)},onBack:function(){t(-1)}}),function(e){switch(e){case"builder":return Object(O.jsx)(Wt,{schema:p,uiSchema:g,formData:C,onSchemaChange:ye,onFormDataChange:Se});case"plugins":return Object(O.jsx)(en,{});case"text":return Object(O.jsx)(tn,{data:F,onChange:we});case"preview":return Object(O.jsx)(Ht,{schema:fe,uiSchema:Oe,text:F});case"editor":return Object(O.jsx)(Kt,{isEditable:P,schema:q,ui:X,onSchemaChange:_e,onUiChange:Ne,onIsEditableChange:ke,onSave:Ie,onUndo:Ee});case"card":return Object(O.jsx)(xn,{schema:ue,uiSchema:pe,onSchemaChange:Ce,onUseMainSchema:Le})}}(_),Object(O.jsx)(qt,{pb:3,children:Object(O.jsx)(R.a,{variant:"contained",color:"warning",fullWidth:!0,onClick:function(){var e=ge();xe(e).then((function(){return o("\u0414\u0430\u043d\u043d\u044b\u0435 \u0441\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u044b","success")})).catch((function(e){return o(e.message,"error")})),oe(!1)},children:"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c"})})]})},kn=n(638),_n=function(){var e=E(),t=e.getConditionalStage,n=e.saveConditionalStage,c=e.getTaskStage,r=Object(s.j)().stageId,i=et(),o=i.parseId,l=i.getFormFields,b=o(r),p=sn().openToast,h=Object(a.useState)({}),f=Object(j.a)(h,2),m=f[0],g=f[1],x=Object(a.useState)({}),v=Object(j.a)(x,2),y=v[0],C=v[1],S=Object(a.useState)(!1),w=Object(j.a)(S,2),k=w[0],_=w[1],N=Object(a.useState)(),I=Object(j.a)(N,2),L=I[0],D=I[1],F=Object(a.useState)(!1),T=Object(j.a)(F,2),B=T[0],R=T[1],A=Object(a.useState)([]),P=Object(j.a)(A,2),z=P[0],M=P[1];Object(a.useEffect)((function(){t(b).then((function(e){C(e.conditions),_(e.pingpong)}))}),[b]),Object(a.useEffect)((function(){var e=function(e){if(e){var n=c(e);return n||t(e)}return t(b)};b&&function(){var t=Object(d.a)(u.a.mark((function t(){var n,a,c;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e();case 2:if(n=t.sent,!(a=k?n.out_stages:n.in_stages)){t.next=9;break}return t.next=7,Promise.all(a.map(function(){var t=Object(d.a)(u.a.mark((function t(n){var a;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e(n);case 2:return a=t.sent,t.abrupt("return",Object(oe.a)({},n,a));case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()));case 7:c=t.sent,Object.keys(c).length>0&&(D(c),R(!0));case 9:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}()()}),[b,k]),Object(a.useEffect)((function(){if(L&&L.length>0){var e=L.map((function(e){var t=Object.values(e)[0],n=t.json_schema?JSON.parse(t.json_schema):{},a={};n&&n.dependencies&&Object.keys(n.dependencies).length>0&&(a=n.dependencies);var c=Object.values(a),r=l(n),i=[];return c.length>0&&(i=c.map((function(e){return function(e){var t=null;return e.hasOwnProperty("oneOf")&&(t=e.oneOf),e.hasOwnProperty("allOf")&&(t=e.allOf),t?t.map((function(e){var t=Object(U.a)({type:"object"},e);return l(t)})).flat():[]}(e)})).flat()),Array.from(new Set([].concat(Object(Pe.a)(r),Object(Pe.a)(i))))})).flat();M(e)}}),[L]),Object(a.useEffect)((function(){console.log("fields",z),g({items:{type:"object",title:"Logic",properties:{field:{enum:z,title:"Field",type:"string"},condition:{enum:["==","!=",">","<",">=","<=","ARRAY-CONTAINS","ARRAY-CONTAINS-NOT"],title:"Condition",type:"string"},value:{title:"Value",type:"string"},type:{title:"Type",enum:["boolean","number","integer","string"],type:"string"}},dependencies:{},required:[]},title:"Logic Array",type:"array",dependencies:{},required:[]})}),[z]);return B?Object(O.jsxs)(qt,{pb:3,children:[Object(O.jsx)(Yt.a,{control:Object(O.jsx)(kn.a,{checked:k,onChange:function(e){_(e.target.checked)},name:"PingPong",color:"primary"}),label:"Ping Pong"}),Object(O.jsx)(gt,{schema:m,formData:y,onChange:function(e){return C(e)},onSubmit:function(){n(b,{conditions:y,pingpong:k}).then((function(e){return p("\u0414\u0430\u043d\u043d\u044b\u0435 \u0441\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u044b","success")}))}})]}):Object(O.jsx)("p",{children:"No node connection or end_ui detected. Connect to one or check if form has fields."})},Nn=n(322),In=n(323),En=function(){var e,t,n=E().createChain,a=Object(s.i)(),c=Object(s.h)(),r=Object(s.j)().campaignId,i=(0,et().parseId)(r),o=(null===c||void 0===c||null===(e=c.state)||void 0===e||null===(t=e.from)||void 0===t?void 0:t.pathname)||"/";return Object(O.jsx)(qt,{py:2,children:Object(O.jsx)(gt,{schema:Nn,uiSchema:In,onSubmit:function(e){console.log(e),r?n(Object(U.a)({campaign:i},e)).then((function(){a(o)})):alert("Error: No campaign id")}})})},Ln=["task_stage"],Dn=function(){var e=E(),t=e.getResponseFlattener,n=e.saveResponseFlattener,c=sn().openToast,r=Object(s.j)().id,i=et().parseId,o=Object(a.useState)(),l=Object(j.a)(o,2),u=l[0],d=l[1],b=i(r);Object(a.useEffect)((function(){t(b).then((function(e){console.log(e);var t=e.task_stage,n=Object(z.a)(e,Ln),a=Object(U.a)({task_stage:t.id},n);d(a)}))}),[b]);return Object(O.jsx)(L.a,{p:2,children:Object(O.jsx)(gt,{schema:{title:"Response Flattener",type:"object",required:["task_stage"],properties:{task_stage:{type:"integer",title:"Task stage"},copy_first_level:{type:"boolean",title:"Copy first level"},flatten_all:{type:"boolean",title:"Flatten all"},copy_system_fields:{type:"boolean",title:"Copy system fields"},exclude_list:{type:"array",title:"Exclude list",items:{type:"string"}},columns:{type:"array",title:"Columns",items:{type:"string"}}}},uiSchema:{exclude_list:{"ui:widget":"textarea"},columns:{"ui:widget":"textarea"}},formData:u,onChange:function(e){console.log(e),d(e)},onSubmit:function(){n(b,u).then((function(){return c("Saved","success")}))}})})},Fn=n(324),Tn=n.n(Fn),Bn=function(e){var t=e.id,n=e.stage,a=e.onDownloadClick,c=e.onSettingsClick;return console.log(t,n),Object(O.jsx)(A.a,{sx:{width:"100%"},children:Object(O.jsx)(M.a,{action:Object(O.jsxs)(G.a,{direction:"row",spacing:1,children:[Object(O.jsx)(H.a,{onClick:function(){c(t)},children:Object(O.jsx)(Tn.a,{})}),Object(O.jsx)(R.a,{variant:"contained",onClick:function(){a(n.id,t)},children:"\u0421\u043a\u0430\u0447\u0430\u0442\u044c"},"open_button")]}),title:"Stage: ".concat(n.name),subheader:"ID: ".concat(t),titleTypographyProps:{variant:"h6"},subheaderTypographyProps:{variant:"caption"}})})},Rn=function(){var e=E(),t=e.getResponseFlattenerList,n=e.downloadFlattenedResponses,c=Object(s.i)(),r=sn().openToast,i=Object(s.j)().campaignId,o=(0,et().parseId)(i),l=Object(a.useState)([]),u=Object(j.a)(l,2),d=u[0],b=u[1];Object(a.useEffect)((function(){t(o).then((function(e){b(e)}))}),[o]);var p=function(e,t){n(e,t).catch((function(e){return r(e.message)}))},h=function(e){c("".concat(e))};return Object(O.jsxs)(L.a,{px:3,py:1,width:"100%",children:[Object(O.jsx)(R.a,{variant:"contained",onClick:function(){c("new")},children:"\u0421\u043e\u0437\u0434\u0430\u0442\u044c"}),Object(O.jsx)(F.a,{container:!0,py:2,spacing:2,children:d.map((function(e,t){return Object(O.jsx)(F.a,{item:!0,xs:12,children:Object(O.jsx)(Bn,{id:e.id,stage:e.task_stage,onDownloadClick:p,onSettingsClick:h})},t)}))})]})},An=function(){var e=E().createResponseFlattener,t=sn().openToast,n=Object(s.i)(),c=Object(a.useState)({}),r=Object(j.a)(c,2),i=r[0],o=r[1];return Object(O.jsx)(L.a,{p:2,children:Object(O.jsx)(gt,{schema:{title:"Response Flattener",type:"object",required:["task_stage"],properties:{task_stage:{type:"integer",title:"Task stage"},copy_first_level:{type:"boolean",title:"Copy first level"},flatten_all:{type:"boolean",title:"Flatten all"},copy_system_fields:{type:"boolean",title:"Copy system fields"},exclude_list:{type:"string",title:"Exclude list"},columns:{type:"string",title:"Columns"}}},uiSchema:{exclude_list:{"ui:widget":"textarea"},columns:{"ui:widget":"textarea"}},formData:i,onChange:function(e){o(e)},onSubmit:function(){e(i).then((function(){return t("Saved","success")})).then((function(){return n(-1)}))}})})},Pn=function(){return Object(O.jsx)(g,{children:Object(O.jsx)(on,{children:Object(O.jsx)(o.a,{children:Object(O.jsxs)(s.e,{children:[Object(O.jsxs)(s.c,{path:"/",element:Object(O.jsx)(C,{children:Object(O.jsx)(Re,{})}),children:[Object(O.jsxs)(s.c,{path:"campaign",children:[Object(O.jsxs)(s.c,{path:":campaignId",children:[Object(O.jsxs)(s.c,{path:"flattener",children:[Object(O.jsx)(s.c,{path:"new",element:Object(O.jsx)(An,{})}),Object(O.jsx)(s.c,{path:":id",element:Object(O.jsx)(Dn,{})}),Object(O.jsx)(s.c,{index:!0,element:Object(O.jsx)(Rn,{})})]}),Object(O.jsxs)(s.c,{path:"chain",children:[Object(O.jsxs)(s.c,{path:":chainId",children:[Object(O.jsx)(s.c,{path:"createstage/:stageId",element:Object(O.jsx)(wn,{})}),Object(O.jsx)(s.c,{path:"createlogic/:stageId",element:Object(O.jsx)(_n,{})}),Object(O.jsx)(s.c,{index:!0,element:Object(O.jsx)(ct,{})})]}),Object(O.jsx)(s.c,{path:"new",element:Object(O.jsx)(En,{})}),Object(O.jsx)(s.c,{index:!0,element:Object(O.jsx)(Ae,{})})]})]}),Object(O.jsx)(s.c,{index:!0,element:Object(O.jsx)(re,{})})]}),Object(O.jsx)(s.c,{index:!0,element:Object(O.jsx)(re,{})})]}),Object(O.jsx)(s.c,{path:v.path,element:Object(O.jsx)(ie,{})})]})})})})},Un=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,665)).then((function(t){var n=t.getCLS,a=t.getFID,c=t.getFCP,r=t.getLCP,i=t.getTTFB;n(e),a(e),c(e),r(e),i(e)}))};i.a.render(Object(O.jsx)(c.a.StrictMode,{children:Object(O.jsx)(Pn,{})}),document.getElementById("root")),Un()}},[[571,1,2]]]);
//# sourceMappingURL=main.03b741d3.chunk.js.map